<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Secret Santa Assignment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Mountains+of+Christmas&display=swap');
        
        .christmas-font {
            font-family: 'Mountains of Christmas', cursive;
        }
        
        .snow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }
        
        .snowflake {
            position: absolute;
            top: -10px;
            color: white;
            user-select: none;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        .content {
            position: relative;
            z-index: 2;
        }
        
        body {
            background: linear-gradient(135deg, #0f4c75 0%, #1e3a5f 50%, #0f4c75 100%);
            min-height: 100vh;
        }
        
        .christmas-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 3px solid #c41e3a;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .reveal-animation {
            animation: revealGift 0.8s ease-out;
        }
        
        @keyframes revealGift {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }
        
        .secret-message {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 3px solid #c41e3a;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="snow" id="snow"></div>
    
    <div class="content min-h-screen flex items-center justify-center p-4">
        <div class="christmas-card rounded-xl p-8 max-w-2xl w-full">
            <div class="text-center mb-8">
                <h1 class="christmas-font text-5xl text-red-700 mb-4">Secret Santa</h1>
                <div id="loading" class="text-gray-600">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-700"></div>
                    <p class="mt-2">Revealing your assignment...</p>
                </div>
            </div>
            
            <div id="assignmentResult" class="hidden">
                <div class="secret-message reveal-animation">
                    <h3 class="christmas-font text-4xl text-red-800 mb-4">ğŸ… Your Secret Santa Assignment ğŸ„</h3>
                    <div class="text-xl font-bold text-gray-800 mb-2">
                        <span id="guestName" class="text-lg"></span>, you are buying a gift for:
                    </div>
                    <div id="assignedPerson" class="christmas-font text-5xl text-red-700 mb-6"></div>
                    
                    <div class="bg-red-50 p-4 rounded-lg mb-4 border-2 border-red-200">
                        <h4 class="font-bold text-red-800 mb-2">ğŸ„ Party Details:</h4>
                        <div class="space-y-1 text-gray-700">
                            <div><strong>Party:</strong> <span id="partyName"></span></div>
                            <div id="budgetInfo" class="hidden"><strong>ğŸ’° Budget:</strong> <span id="budget"></span></div>
                            <div id="criteriaInfo" class="hidden"><strong>ğŸ“ Criteria:</strong> <span id="criteria"></span></div>
                        </div>
                    </div>
                    
                    <div class="text-gray-700">
                        <p>ğŸ¤« Keep it a secret!</p>
                        <p>ğŸ Make it special!</p>
                        <p>â„ï¸ Spread the Christmas joy!</p>
                    </div>
                </div>
            </div>
            
            <div id="error" class="hidden">
                <div class="bg-red-100 border-2 border-red-400 p-6 rounded-lg text-center">
                    <h3 class="text-xl font-bold text-red-800 mb-2">âŒ Link Not Valid</h3>
                    <p class="text-red-600">This Secret Santa invitation link is invalid or has expired.</p>
                    <p class="text-red-600 text-sm mt-2">Please contact your party organizer for a new link.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Create snowflakes
        function createSnowflakes() {
            const snow = document.getElementById('snow');
            const snowflakeSymbols = ['â„', 'â…', 'â†'];
            
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = snowflakeSymbols[Math.floor(Math.random() * snowflakeSymbols.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = Math.random() * 3 + 2 + 's';
                snowflake.style.opacity = Math.random();
                snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
                snowflake.style.animationDelay = Math.random() * 2 + 's';
                snow.appendChild(snowflake);
            }
        }
        
        createSnowflakes();
        
        // Get guest ID from URL
        const urlParts = window.location.pathname.split('/');
        const guestId = urlParts[urlParts.length - 1];
        
        // Load assignment
        async function loadAssignment() {
            try {
                const response = await fetch(`/api/guest/${guestId}/assignment`);
                const data = await response.json();
                
                if (response.ok) {
                    showAssignment(data);
                } else {
                    showError();
                }
            } catch (error) {
                showError();
            }
        }
        
        function showAssignment(data) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('assignmentResult').classList.remove('hidden');
            
            document.getElementById('guestName').textContent = data.guestName;
            document.getElementById('partyName').textContent = data.party.name;
            document.getElementById('assignedPerson').textContent = data.assignment;
            
            if (data.party.budget) {
                document.getElementById('budgetInfo').classList.remove('hidden');
                document.getElementById('budget').textContent = data.party.budget;
            }
            
            if (data.party.criteria) {
                document.getElementById('criteriaInfo').classList.remove('hidden');
                document.getElementById('criteria').textContent = data.party.criteria;
            }
        }
        
        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }
        
        // Load assignment on page load
        loadAssignment();
    </script>
</body>
</html>
